{% extends "base.html" %}
{% block content %}
<style>
    .dash-container { max-width: 1200px; margin: 30px auto; padding: 20px; font-family: 'Poppins', sans-serif; }
    .welcome-header { margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 15px; }
    
    /* Stats Cards */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 40px; }
    .stat-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 20px; border-bottom: 4px solid #ddd; }
    .stat-card.total { border-color: #3498db; }
    .stat-card.diabetic { border-color: #e74c3c; }
    .stat-card.normal { border-color: #2ecc71; }
    .stat-icon { font-size: 2.5rem; background: #f8f9fa; padding: 15px; border-radius: 12px; }
    .stat-data h3 { margin: 0; font-size: 28px; color: #2c3e50; }
    .stat-data p { margin: 0; color: #7f8c8d; font-size: 14px; font-weight: 600; }

    /* Tables */
    .table-container { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .custom-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    .custom-table th { text-align: left; padding: 12px; border-bottom: 2px solid #f1f1f1; color: #7f8c8d; font-size: 13px; text-transform: uppercase; }
    .custom-table td { padding: 15px 12px; border-bottom: 1px solid #f9f9f9; font-size: 14px; }
    .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
    .badge-red { background: #fdecea; color: #e74c3c; }
    .badge-green { background: #e8f6f0; color: #2ecc71; }
</style>

<div class="dash-container">
    <div class="welcome-header d-flex justify-content-between align-items-center">
        <div>
            <h2 style="margin:0;">Hello, <span style="color: #27AE60;">{{ user.name }}</span> üëã</h2>
            <p style="color: #7f8c8d;">Role: {{ 'Laboratory Administrator' if user.license_no else 'Staff User' }}</p>
        </div>
        <a href="/predict" class="btn btn-dark" style="border-radius: 10px; padding: 10px 25px;">+ Start New Prediction</a>
    </div>

    <div class="stats-grid">
        <div class="stat-card total">
            <div class="stat-icon">üìã</div>
            <div class="stat-data">
                <h3>{{ total_preds }}</h3>
                <p>TOTAL PREDICTIONS</p>
            </div>
        </div>
        <div class="stat-card diabetic">
            <div class="stat-icon">‚ö†Ô∏è</div>
            <div class="stat-data">
                <h3>{{ diabetic_count }}</h3>
                <p>DIABETIC CASES</p>
            </div>
        </div>
        <div class="stat-card normal">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-data">
                <h3>{{ normal_count }}</h3>
                <p>NORMAL CASES</p>
            </div>
        </div>
    </div>

    <div class="table-container">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 style="margin:0;">üïí Last 5 Lab Activities</h4>
            <a href="/view-patients" style="font-size: 13px; color: #3498db; text-decoration: none;">View All Patients ‚Üí</a>
        </div>
        <table class="custom-table">
            <thead>
                <tr>
                    <th>Patient Name</th>
                    <th>Prediction Result</th>
                    <th>Glucose/BMI</th>
                    <th>Accuracy</th>
                    <th>Date & Time</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for report in recent_reports %}
                <tr>
                    <td><b>{{ report.patient.name }}</b></td>
                    <td>
                        <span class="status-badge {{ 'badge-red' if report.prediction_result == 'Diabetic' else 'badge-green' }}">
                            {{ report.prediction_result }}
                        </span>
                    </td>
                    <td>{{ report.glucose }} / {{ report.bmi }}</td>
                    <td style="color: #27AE60; font-weight: bold;">{{ report.accuracy }}</td>
                    <td style="color: #95a5a6;">{{ report.date.strftime('%d %b, %I:%M %p') }}</td>
                    <td>
                        <a href="/download-report/{{ report.id }}" style="text-decoration:none;">üì• PDF</a>
                    </td>
                </tr>
                {% endfor %}
                {% if not recent_reports %}
                <tr>
                    <td colspan="6" style="text-align:center; padding: 40px; color: #bdc3c7;">No activity recorded yet.</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}